<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>비밀번호 찾기</title>
    <script src="https://code.jquery.com/jquery-3.7.1.js"
        integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap');

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans KR', sans-serif;
        }

        body,
        html {
            margin: 0;
            height: 100%;
            background-color: #f4f4f8;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .signup-box {
            max-width: 470px;
            padding: 50px 40px 60px;
            border-radius: 15px;
            background-color: #fff;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .signup-box h2 {
            font-weight: 800;
            font-size: 28px;
            margin-bottom: 15px;
            color: #333;
        }

        .signup-box p.desc {
            font-size: 14px;
            margin-bottom: 30px;
            color: #666;
        }

        input[type="text"],
        input[type="password"],
        select {
            width: 100%;
            height: 45px;
            border-radius: 8px;
            border: 1px solid #ddd;
            padding: 0 15px;
            margin-bottom: 15px;
            font-size: 14px;
            color: #333;
            transition: border-color 0.3s ease;
        }

        input[type="text"]:focus,
        input[type="password"]:focus,
        select:focus {
            outline: none;
            border-color: #7b67f7;
        }

        input::placeholder {
            color: #aaa;
        }

        .email-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
        }

        .email-row input {
            flex-grow: 1;
            margin-bottom: 0;
        }

        .email-row span {
            font-size: 16px;
            font-weight: bold;
            color: #555;
        }

        .email-row select {
            width: 150px;
            height: 45px;
            padding-left: 15px;
        }

        .dob-row {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        .dob-row select {
            width: calc(33.33% - 6.67px);
            padding-left: 15px;
        }

        .dob-row select:not(:last-child) {
            margin-right: 0;
        }


        button.submit-btn {
            width: 100%;
            height: 48px;
            border-radius: 8px;
            border: none;
            background-color: #7b67f7;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-bottom: 20px;
        }

        button.submit-btn:hover {
            background-color: #6250e0;
        }

        .a-group {
            margin-top: 20px;
        }

        .a-back {
            display: inline-block;
            padding: 12px 20px;
            background-color: #e5e7eb;
            color: #1f2937;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            text-decoration: none;
            transition: background-color 0.3s ease;
        }

        .a-back:hover {
            background-color: #d1d5db;
        }

        /* 오류 메시지 스타일 */
        .error-message {
            color: #f47f7f;
            font-size: 13px;
            margin-bottom: 15px;
            height: 20px;
        }

        /* 성공 메시지 스타일 */
        .success-message {
            color: #4CAF50;
            font-size: 13px;
            margin-bottom: 15px;
            height: 20px;
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="signup-box">
            <h2>계정 찾기</h2>
            <p class="desc">가입 시 등록한 이메일과 전화번호를 입력하세요.</p>

            <div v-if="errorMessage" class="error-message">{{ errorMessage }}</div>
            <div v-if="successMessage" class="success-message">{{ successMessage }}</div>

            <form @submit.prevent="findPassword">
                <div class="email-row">
                    <input type="text" v-model="emailId" placeholder="이메일 주소" required />
                    <span>@</span>
                    <select v-model="emailDomain">
                        <option value="naver.com">naver.com</option>
                        <option value="gmail.com">gmail.com</option>
                        <option value="daum.net">daum.net</option>
                        <option value="kakaocorp.com">kakaocorp.com</option>
                        <option value="facebook.com">facebook.com</option>
                    </select>
                </div>
                <input type="text" v-model="phone" class="phone" placeholder="휴대폰 번호 ('-' 제외 11자리)" required
                    pattern="\d{11}" title="하이픈 없이 11자리 숫자를 입력해주세요." />

                <div class="dob-row">
                    <select v-model="birthYear" required>
                        <option value="" disabled>년</option>
                        <option v-for="year in years" :key="year" :value="year">{{ year }}년</option>
                    </select>
                    <select v-model="birthMonth" required>
                        <option value="" disabled>월</option>
                        <option v-for="month in months" :key="month" :value="month">{{ month }}월</option>
                    </select>
                    <select v-model="birthDay" required>
                        <option value="" disabled>일</option>
                        <option v-for="day in days" :key="day" :value="day">{{ day }}일</option>
                    </select>
                </div>

                <button type="submit" class="submit-btn">다음</button>
                <div class="a-group">
                    <a class="a-back no-line" href="login.html">되돌아가기</a>
                </div>
            </form>
        </div>
    </div>

    <script>
        const app = Vue.createApp({
            data() {
                return {
                    // 계정 찾기 관련 데이터
                    emailId: '',
                    emailDomain: 'naver.com', // 기본값 설정
                    phone: '',
                    birthYear: '',
                    birthMonth: '',
                    birthDay: '',

                    // 날짜 옵션
                    years: [],
                    months: [],
                    days: [],

                    // 메시지 관련
                    errorMessage: '',
                    successMessage: ''
                };
            },
            methods: {
                findPassword: async function () {
                    this.errorMessage = ''; // 이전 오류 메시지 초기화
                    this.successMessage = ''; // 이전 성공 메시지 초기화

                    // 입력 값 검증
                    if (!this.emailId || !this.emailDomain || !this.phone || !this.birthYear || !this.birthMonth || !this.birthDay) {
                        this.errorMessage = '모든 정보를 정확히 입력해주세요.';
                        return;
                    }

                    // 휴대폰 번호 형식 검증 (11자리 숫자)
                    const phoneRegex = /^\d{11}$/;
                    if (!phoneRegex.test(this.phone)) {
                        this.errorMessage = '휴대폰 번호는 하이픈 없이 11자리의 숫자로 입력해주세요.';
                        return;
                    }

                    const fullEmail = `${this.emailId}@${this.emailDomain}`;
                    // 날짜 형식을 'YYYY-MM-DD'로 맞춰서 전송
                    const birthDate = `${this.birthYear}-${String(this.birthMonth).padStart(2, '0')}-${String(this.birthDay).padStart(2, '0')}`;

                    try {
                        // 요청 방식을 GET으로 변경하고, URL 쿼리 파라미터로 데이터 전송
                        const response = await $.ajax({
                            url: `http://localhost:3009/findPassword?email=${fullEmail}&phone=${this.phone}&birth=${birthDate}`,
                            dataType: "json",
                            type: "GET"
                        });

                        if (response.success) {
                            this.successMessage = response.message;
                            // 비밀번호 찾기 성공 후, 약 3초 뒤에 로그인 페이지로 이동 (선택 사항)
                            setTimeout(() => {
                                window.location.href = 'login.html';
                            }, 3000);
                        } else {
                            this.errorMessage = response.message;
                        }
                    } catch (error) {
                        console.error("API 호출 오류:", error);
                        // 서버에서 보낸 오류 메시지가 있다면 표시
                        if (error.responseJSON && error.responseJSON.message) {
                            this.errorMessage = error.responseJSON.message;
                        } else {
                            this.errorMessage = '서버 오류가 발생했습니다. 다시 시도해주세요.';
                        }
                    }
                }
            },
            mounted() {
                // 년도 생성
                const currentYear = new Date().getFullYear();
                for (let y = currentYear; y >= currentYear - 100; y--) {
                    this.years.push(y);
                }
                // 월 생성
                for (let m = 1; m <= 12; m++) {
                    this.months.push(m);
                }
                // 일 생성
                for (let d = 1; d <= 31; d++) {
                    this.days.push(d);
                }

                // 초기값 설정: select 엘리먼트의 value를 vue 데이터로 바인딩
                this.emailDomain = document.querySelector('.email-row select').value;
            }
        });

        app.mount('#app');
    </script>
</body>

</html>